<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Lab 8</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="imgs/about.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link
    href="https://fonts.googleapis.com/css?family=https://fonts.googleapis.com/css?family=Inconsolata:400,500,600,700|Raleway:400,400i,500,500i,600,600i,700,700i"
    rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">

  <!-- =======================================================
  * Template Name: MyPortfolio - v4.10.0
  * Template URL: https://bootstrapmade.com/myportfolio-bootstrap-portfolio-website-template/
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
</head>

<body>

  <!-- ======= Navbar ======= -->

  <main id="main">

    <section class="section">
      <div class="container">
        <div class="row mb-4 p-5 align-items-center">
          <a class="navbar-brand" href="index.html">Back to Portfolio</a>
          <p> </p>
          <h1>Lab 8</h1>

          <p> </p>
          <h4>Objective: </h4>
          <p>
            In this lab, I conduct a high-speed stunt using my robot. The goal is to have the robot speeds toward a wall and, when the kalman filtered extrapolation of TOF readings determines it is on the stunt pad, a flip is induced, and the robot speeds opposite the initial direction of travel. 
          </p>

          <p> </p>
          <p> </p>

          <h4> Stunt Scripting </h4>
          <p>
            To achieve this stunt, as with all labs, I first created a new bluetooth command to trigger the sequence remotely. The script on the jupyter notebook side was taken directly from my previous labs, as no processing is done off-board - it only relays the stunt command, and collates data sent over bluetooth for visualizing after the stunt. The stunt function on the arduino, consists of three short parts: driving towards the wall, the flip sequence, and driving away. I drive towards the wall at max PWM, then reverse the direction of max PWM and brake shortly to flip when the wall distance is correct, and finally continue the max reverse PWM to return to the start line.
          </p>

          <p> </p>
          <p> </p>

          <script src="https://gist.github.com/Kumagi360/3dd263c3d0e8a3e66e2ea52f9e863e68.js"></script>

          <p> </p>
          <p> </p>
          
          <p>
            The kalman filter, whos (abstracted here) code was taken from my lab 7, heavily favored the sensor input. As my sampling rate did not significantly change, the filter's matrices remained the same.The stunt body runs a prediction step when new data does not come in, finding the gradient between the previous two sensor values and multiplying by the time interval before passing this extrapolated sensor value into the kalman filter.  I arrived at the delay timings for each step in the flip sequence through trial and error, watching carefully how much 'kick' I would generate at the reversal moment, and watching how much the robot laterally pivoted during its flip. I added the proximity variable, and the 800mS initial flip-free period to eliminate the arbitrary readings generated by the TOF until the robot is within two metres of the wall. Starting from the line at four metres, at 255 PWM on a full battery, it took about that long to close in on the pad. The speed variable is sent over bluetooth to mark the flip.
          </p>

          <p> </p>
          <p> </p>

          <h4> Stunt Outcomes </h4>
          <p>
            Despite having attempted the stunt over 50 times across multiple days, I could not successfully flip the robot. I had a number of attempts where the 'kick' of the robot on reverse PWM reached ~45 degrees, but never up to the ~60 degrees needed to invert. No stunt data indicated an issue with the kalman filtered distance sensing, or execution of the flip body. Upon analysing the data from the stunts and watching their recordings, I hypothesise three possible explanations. 

            <p> </p>

            1. To flip, there must be a large deceleration on the pad. I noticed in a number of recordings my robot would lock-up the wheels and skid rather than actually reversing the rotation. This is likely due to a lack of mechanical grip betwen the wheels and the pad - either the wheel grooves had been worn too smooth, or the pad was too dusty. As a result, the robot would slide over the rest of the pad and often impact the barrier rather than flipping. Sometimes, I would also see the robot do a lateral spin, likely because there was more grip on one side of the robot than the other.

            <p> </p>

            2. To flip, the reversal in rotation of the wheels have to be immediate. If when commanded to reverse rotation, a motor first coasts to a stop then reverses, the  deceleration would not be significant enough to invert. While I incorporated slow decay into my motor control, and visually confirmed that off the ground the robot is arresting rotation immediately, it would often seem that on the ground the motors were coasting rather than braking.

            <p> </p>

            3. To flip, the delay timings have to be just right for the surface conditions. It is possible I never assigned the perfect values. To be thorough and exhuastive, I brute forced every combination of kfDistance [600, 1000] in steps of 100 and flip delay [0, 500] in steps of 100. These two variables are key to achieveing the flip motion itself, and some combinations yielded better results than others.
          </p>

          <p> </p>
          <p> </p>

          <h4> Stunt Media and Data </h4>
          <p> Despite not having a successful stunt, I had a number of notable attempts, and collected their data:</p>

          <p> </p>
          <p> </p>

          <h5> Notable Run 1 </h5>
          <p> This run reached ~30 degrees of kick, and had the least sliding problem on the matt of all the runs. As the data shows, it correctly reversed PWM at 1.4 seconds into the stunt at about 600mm from the wall. It returned to the line after 2.3 seconds. It lost TOF readings after the reversal, but the readings on approach were correct, and the kalman filtered values overlapped with the measured. </p>

          <video preload="auto" controls style="width: 50%; height: 50%">
            <source src="imgs/lab8/fa_1.MOV" type="video/mp4">
          </video>

          <img class="img-fluid" src="imgs/lab8/stunt_fa_1.png" style="width: 50%; height: 50%">

          <p> </p>
          <p> </p>

          <h5> Notable Run 2 </h5>
          <p> This run showcases the consequence of the lateral spin due to unequal grip, as it consumes the impulse needed to invert. As the data shows, it correctly reversed PWM at 1.3 seconds into the stunt at about 500mm from the wall. It returned to the line after 4.2 seconds. After the spin and some wall-assisted flips, the TOF readings again expectedly  became unreliable as it looked out into the hallway after 'flipping'.</p>

          <video preload="auto" controls style="width: 50%; height: 50%">
            <source src="imgs/lab8/fa_2.MOV" type="video/mp4">
          </video>

          <img class="img-fluid" src="imgs/lab8/stunt_fa_2.png" style="width: 50%; height: 50%">

          <p> </p>
          <p> </p>

          <h5> Notable Run 3 </h5>
          <p> This run, from before incorporating the Kalman filter, showcases the issue of locking up and sliding off the pad and into the wall. It returned to the line after 2.6 seconds. As the data shows, it correctly reversed PWM at 1.2 seconds into the stunt at about 600mm from the wall. </p>

          <video preload="auto" controls style="width: 50%; height: 50%">
            <source src="imgs/lab8/fa_3.MOV" type="video/mp4">
          </video>

          <img class="img-fluid" src="imgs/lab8/stunt_fa_3.png" style="width: 50%; height: 50%">


        </div>
      </div>

    </section>


  </main><!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer class="footer" role="contentinfo">
    <div class="container">
      <div class="row">
        <div class="col-sm-6">
          <p class="mb-1">&copy; Kunal Gupta, 2023</p>
          <div class="credits">
            <!--
            All the links in the footer should remain intact.
            You can delete the links only if you purchased the pro version.
            Licensing information: https://bootstrapmade.com/license/
            Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/buy/?theme=MyPortfolio
          -->
            Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
          </div>
        </div>
        <div class="col-sm-6 social text-md-end">
          <a href="https://www.linkedin.com/in/kunalgupta360/"><span class="bi bi-linkedin"></span></a>
          <a href="https://github.com/Kumagi360/Fast_Robots_Portfolio"><span class="bi bi-github"></span></a>
        </div>
      </div>
    </div>
  </footer>

  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i
      class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>

  <!-- Template Main JS File -->
  <script src="assets/js/main.js"></script>

</body>

</html>